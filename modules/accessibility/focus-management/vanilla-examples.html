<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Focus Management - Vanilla JS Examples</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #0f172a; color: #e2e8f0;
      max-width: 900px; margin: 0 auto; padding: 2rem;
      line-height: 1.6;
    }
    h1 { color: #38bdf8; } h2 { color: #818cf8; margin-top: 3rem; }
    .example { background: #1e293b; border-radius: 0.75rem; padding: 1.5rem; margin: 1rem 0; border: 1px solid #22c55e; }
    .label { font-size: 0.75rem; font-weight: bold; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 0.5rem; color: #22c55e; }
    .btn { background: #3b82f6; color: white; border: none; padding: 0.5rem 1.25rem; border-radius: 0.5rem; cursor: pointer; font-size: 1rem; margin: 0.25rem; }
    .btn:hover { background: #2563eb; }
    .btn:focus-visible { outline: 3px solid #38bdf8; outline-offset: 2px; }
    .btn-danger { background: #dc2626; }
    .btn-danger:hover { background: #b91c1c; }

    /* Modal Styles */
    .modal-overlay {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.7);
      display: none; align-items: center; justify-content: center;
      z-index: 1000;
    }
    .modal-overlay.open { display: flex; }
    .modal {
      background: #1e293b; border: 1px solid #334155;
      border-radius: 1rem; padding: 2rem;
      max-width: 500px; width: 90%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    }
    .modal h2 { margin-top: 0; }
    .modal-actions { display: flex; gap: 0.5rem; justify-content: flex-end; margin-top: 1.5rem; }

    /* Native dialog */
    dialog {
      background: #1e293b; color: #e2e8f0;
      border: 1px solid #334155; border-radius: 1rem;
      padding: 2rem; max-width: 500px; width: 90%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    }
    dialog::backdrop { background: rgba(0,0,0,0.7); }
    dialog h2 { margin-top: 0; color: #818cf8; }

    input, textarea {
      background: #0f172a; color: #e2e8f0; border: 1px solid #475569;
      padding: 0.5rem; border-radius: 0.375rem; font-size: 1rem; width: 100%;
    }
    input:focus, textarea:focus { outline: 2px solid #38bdf8; border-color: #38bdf8; }
    label { display: block; margin-bottom: 0.25rem; font-weight: 500; }
  </style>
</head>
<body>

  <h1>Focus Management Examples</h1>
  <p>All examples below demonstrate proper focus trapping, restoration, and management.</p>

  <main>

    <!-- ============================================
         1. NATIVE <dialog> ELEMENT (BEST PRACTICE)
         ============================================ -->
    <h2>1. Native &lt;dialog&gt; (Recommended)</h2>
    <div class="example">
      <div class="label">✅ Built-in focus trap, Escape, focus restoration</div>
      <button class="btn" id="open-native-dialog">Open Native Dialog</button>

      <dialog id="native-dialog" aria-labelledby="native-dialog-title">
        <h2 id="native-dialog-title">Delete Item?</h2>
        <p>This action cannot be undone. Are you sure you want to delete this item?</p>
        <div class="modal-actions">
          <button class="btn" id="native-cancel">Cancel</button>
          <button class="btn btn-danger" id="native-confirm">Delete</button>
        </div>
      </dialog>
    </div>


    <!-- ============================================
         2. CUSTOM FOCUS TRAP (When you can't use <dialog>)
         ============================================ -->
    <h2>2. Custom Focus Trap (Manual Implementation)</h2>
    <div class="example">
      <div class="label">✅ Manual focus trap with Escape and restoration</div>
      <button class="btn" id="open-custom-modal">Open Custom Modal</button>

      <div class="modal-overlay" id="custom-modal" role="dialog" aria-modal="true" aria-labelledby="custom-modal-title">
        <div class="modal">
          <h2 id="custom-modal-title">Edit Profile</h2>
          <div style="margin-bottom:1rem;">
            <label for="modal-name">Name</label>
            <input type="text" id="modal-name" value="John Doe">
          </div>
          <div style="margin-bottom:1rem;">
            <label for="modal-email">Email</label>
            <input type="email" id="modal-email" value="john@example.com">
          </div>
          <div class="modal-actions">
            <button class="btn" id="custom-cancel">Cancel</button>
            <button class="btn" id="custom-save" style="background:#22c55e;">Save</button>
          </div>
        </div>
      </div>
    </div>


    <!-- ============================================
         3. FOCUS RESTORATION AFTER DELETE
         ============================================ -->
    <h2>3. Focus After Item Deletion</h2>
    <div class="example">
      <div class="label">✅ Focus moves to next item when current is deleted</div>
      <ul id="item-list" role="list" aria-label="Items">
        <li style="display:flex;align-items:center;gap:0.5rem;margin:0.5rem 0;">
          <span>Item 1</span>
          <button class="btn" style="font-size:0.8rem;padding:0.25rem 0.5rem;" data-index="0">Delete</button>
        </li>
        <li style="display:flex;align-items:center;gap:0.5rem;margin:0.5rem 0;">
          <span>Item 2</span>
          <button class="btn" style="font-size:0.8rem;padding:0.25rem 0.5rem;" data-index="1">Delete</button>
        </li>
        <li style="display:flex;align-items:center;gap:0.5rem;margin:0.5rem 0;">
          <span>Item 3</span>
          <button class="btn" style="font-size:0.8rem;padding:0.25rem 0.5rem;" data-index="2">Delete</button>
        </li>
        <li style="display:flex;align-items:center;gap:0.5rem;margin:0.5rem 0;">
          <span>Item 4</span>
          <button class="btn" style="font-size:0.8rem;padding:0.25rem 0.5rem;" data-index="3">Delete</button>
        </li>
      </ul>
      <div id="delete-status" role="status" aria-live="polite" style="color:#94a3b8;margin-top:0.5rem;"></div>
    </div>

  </main>

  <script>
    /* ============================================
       1. Native <dialog>
       ============================================ */
    const nativeDialog = document.getElementById('native-dialog');
    const openNativeBtn = document.getElementById('open-native-dialog');
    const nativeCancelBtn = document.getElementById('native-cancel');
    const nativeConfirmBtn = document.getElementById('native-confirm');

    openNativeBtn.addEventListener('click', () => {
      nativeDialog.showModal(); // Built-in: focus trap, backdrop, Escape
    });

    nativeCancelBtn.addEventListener('click', () => {
      nativeDialog.close(); // Built-in: focus restoration
    });

    nativeConfirmBtn.addEventListener('click', () => {
      console.log('Deleted!');
      nativeDialog.close();
    });


    /* ============================================
       2. Custom Focus Trap
       ============================================ */
    const customModal = document.getElementById('custom-modal');
    const openCustomBtn = document.getElementById('open-custom-modal');
    const customCancelBtn = document.getElementById('custom-cancel');
    const customSaveBtn = document.getElementById('custom-save');
    let previousFocusElement = null;

    function getFocusableElements(container) {
      return container.querySelectorAll(
        'a[href], button:not([disabled]), input:not([disabled]), textarea:not([disabled]), select:not([disabled]), [tabindex]:not([tabindex="-1"])'
      );
    }

    function trapFocus(container) {
      const focusableEls = getFocusableElements(container);
      const firstEl = focusableEls[0];
      const lastEl = focusableEls[focusableEls.length - 1];

      function handler(e) {
        if (e.key === 'Tab') {
          if (e.shiftKey) {
            if (document.activeElement === firstEl) {
              e.preventDefault();
              lastEl.focus();
            }
          } else {
            if (document.activeElement === lastEl) {
              e.preventDefault();
              firstEl.focus();
            }
          }
        }

        if (e.key === 'Escape') {
          closeCustomModal();
        }
      }

      container.addEventListener('keydown', handler);
      return () => container.removeEventListener('keydown', handler);
    }

    let removeTrap = null;

    function openCustomModal() {
      previousFocusElement = document.activeElement; // Save for restoration
      customModal.classList.add('open');

      // Set inert on background content
      document.querySelectorAll('body > *:not(.modal-overlay)').forEach(el => {
        el.setAttribute('inert', '');
      });

      removeTrap = trapFocus(customModal);

      // Focus first focusable element
      const firstInput = customModal.querySelector('input');
      requestAnimationFrame(() => firstInput?.focus());
    }

    function closeCustomModal() {
      customModal.classList.remove('open');

      // Remove inert
      document.querySelectorAll('[inert]').forEach(el => el.removeAttribute('inert'));

      if (removeTrap) removeTrap();

      // Restore focus to trigger element
      previousFocusElement?.focus();
    }

    openCustomBtn.addEventListener('click', openCustomModal);
    customCancelBtn.addEventListener('click', closeCustomModal);
    customSaveBtn.addEventListener('click', closeCustomModal);

    // Close on overlay click (not modal content)
    customModal.addEventListener('click', (e) => {
      if (e.target === customModal) closeCustomModal();
    });


    /* ============================================
       3. Focus After Item Deletion
       ============================================ */
    const itemList = document.getElementById('item-list');
    const deleteStatus = document.getElementById('delete-status');

    itemList.addEventListener('click', (e) => {
      if (e.target.tagName === 'BUTTON') {
        const li = e.target.closest('li');
        const nextLi = li.nextElementSibling || li.previousElementSibling;

        li.remove();

        // Focus next item's delete button (or previous if last)
        if (nextLi) {
          const nextBtn = nextLi.querySelector('button');
          nextBtn?.focus();
        }

        // Announce deletion
        deleteStatus.textContent = `Item deleted. ${itemList.children.length} items remaining.`;
      }
    });
  </script>
</body>
</html>
